<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>OpenTelemetry Basics | Aiman Ismail</title><meta property="og:site_name" content="Aiman Ismail"><meta property="og:title" content="OpenTelemetry Basics | Aiman Ismail"><meta itemprop=name content="OpenTelemetry Basics | Aiman Ismail"><meta name=twitter:title content="OpenTelemetry Basics | Aiman Ismail"><meta name=application-name content="OpenTelemetry Basics | Aiman Ismail"><meta name=description content><meta name=twitter:description content><meta itemprop=description content><meta property="og:description" content><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/sass/main.min.3b60735c96f5faa623d75aceae8ee0a0c7d19f76a3eed0574c61f7253a4eeb3d.css></head><script>(function(){const t="ThemeColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.userColorScheme="dark":document.documentElement.dataset.userColorScheme="light"})()</script><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/>Aiman Ismail</a></div><div class=flex><a href=/articles/>Articles</a>
<button id=dark-mode-button><svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163.0 101.643 1.641 1.163 1.163.0 00-1.643-1.641zm-16.022 14.38a1.74 1.74.0 000 2.465 1.742 1.742.0 100-2.465zm13.968-2.147a2.904 2.904.0 01-4.108.0 2.902 2.902.0 010-4.107 2.902 2.902.0 014.108.0 2.902 2.902.0 010 4.107z" fill="#ffcc4d"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg><svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M16 2s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2V2zm18 14s2 0 2 2-2 2-2 2h-2s-2 0-2-2 2-2 2-2h2zM4 16s2 0 2 2-2 2-2 2H2s-2 0-2-2 2-2 2-2h2zm5.121-8.707s1.414 1.414.0 2.828-2.828.0-2.828.0L4.878 8.708s-1.414-1.414.0-2.829c1.415-1.414 2.829.0 2.829.0l1.414 1.414zm21 21s1.414 1.414.0 2.828-2.828.0-2.828.0l-1.414-1.414s-1.414-1.414.0-2.828 2.828.0 2.828.0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zM16 32s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2v-2z"/><circle fill="#ffd983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>OpenTelemetry Basics</h1><div class=post-meta><div>By Aiman Ismail | <time>August 13, 2022</time>
| 7 minutes</div><div class=tags><a href=/tags/observability/>observability</a>
<a href=/tags/opentelemetry/>opentelemetry</a>
<a href=/tags/otel-slack/>otel-slack</a>
<a href=/tags/honeycomb/>honeycomb</a></div></div></div></div></header></article><div class=article-post><p>+++
[twitter]
card = &ldquo;summary&rdquo;
site = &ldquo;@twittername&rdquo;
title = &ldquo;Special Title for the Card&rdquo;
description = &ldquo;Special Description for the card max. 200 characters&rdquo;
image = &ldquo;<a href=https://example.com/great-picture.jpg%22>https://example.com/great-picture.jpg"</a>
+++</p><h1 id=opentelemetry-basics><a href=#opentelemetry-basics class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>OpenTelemetry Basics</h1><p>I got to work on integrating <a href=https://opentelemetry.io/>OpenTelemetry</a> in an application that our team maintains recently so I&rsquo;m starting a series documenting my learnings throughout this journey.</p><p>A little background info on the application I&rsquo;m working on: it&rsquo;s a Slack chatbot written in Typescript using BoltJS. Our goal is to know how many users are using our Slack bot with a breakdown of the percentage of successful and error interactions. When an error happened, we also want to know what exactly the user did and the current state of the application that caused it to error. Based on my reading, the last sentence is exactly what observability promises, So that&rsquo;s why we&rsquo;re giving it a try.</p><p>OpenTelemetry can be divided into three categories: tracing, logging, and metrics; but I&rsquo;ll be focusing on tracing in this series.</p><h2 id=tracing-primers><a href=#tracing-primers class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Tracing Primers</h2><p>To get started you should know some basic concepts about tracing.</p><h3 id=traces-spans><a href=#traces-spans class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Traces, Spans</h3><p>A trace consists of multiple spans and a span is a unit of work with a start and end time. In a span, you can create events that marks when something happened in the lifetime of the span.</p><p>A span can also have nested spans and these are called child spans. The parent span is usually representing some abstract unit of work, like the lifetime of a HTTP request when it from when it hits the application
until the response is sent. Child spans can be used to get more details into the operations done during the lifetime of that parent span ie. API call to another service to fetch more informations.</p><h3 id=span-attributes-status-errors><a href=#span-attributes-status-errors class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Span attributes, Status, Errors</h3><p>To add context to the spans, you can set custom attributes. Ideally, you want to send all the information that will help when debugging your application in the future so that later you don&rsquo;t have to modify the code and add more attribute when you noticed an issue and realized that you don&rsquo;t have enough information to debug the issue.</p><p>If your application encounters an error, you can set the span status to ERROR and also add the stack trace to the context for use in debugging. By default your span status will be set to OK.</p><h3 id=span-exporter><a href=#span-exporter class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Span Exporter</h3><p>After the span ends, you&rsquo;ll want to send it to a backend service that will store and process it so that you can use it later. The sending is done by <a href=https://opentelemetry.io/docs/instrumentation/js/exporters/>OTel Exporters</a>. There are multiple backend available that accepts OTel traces as inputs but such as Jaeger, Zipkin but for my testing I&rsquo;m using Honeycomb with the OLTP Collector.</p><h3 id=debugging><a href=#debugging class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Debugging</h3><p>For debugging, there&rsquo;s also the <code>ConsoleSpanExporter</code> which will print out your spans in the console instead of sending it anywhere. I find this very useful to get fast response on what is being sent over but it&rsquo;s hard to do analysis with it so in production environment you should configure the exporter to use other backends instead.</p><h2 id=automatic-vs-manual-instrumentation><a href=#automatic-vs-manual-instrumentation class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Automatic vs Manual Instrumentation</h2><p>Now we got the basics out of the way, let&rsquo;s look at how you can start adding spans to your application to build traces.</p><p>The easiest way to get started is to use auto instrumentation which will automatically injects code in the HTTP,
requests, DNS, libraries that you&rsquo;re using to create spans and events. In nodejs, this can be done by installing the <a href=https://www.npmjs.com/package/@opentelemetry/auto-instrumentations-node><code>auto-instrumentations-node</code></a> NPM package. This package pulls in several other packages to automatically instrument your application.</p><p>This is a nice onboarding experience but I get overwhelmed by the amount of data sent when by these auto instrumentation package. Therefore, I recommend to you to start with manual instrumentation instead.</p><p>With manual instrumentation, you&rsquo;re forced to be intentional with the data that you&rsquo;re sending to the backend. With this I get to decide which information I want to send over and already have in mind what I want to do with it and which information I would like to gain from it.</p><h3 id=initialization><a href=#initialization class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Initialization</h3><p>Whatever approach you end up with for the instrumentation, you&rsquo;ll want to make sure that you&rsquo;re initializing the OTel libraries at the start of your application. This is required because if you starts it later, your application might already be handling request when your OTel libraries are not initialized yet, causing it to miss some requests, or worse encounter errors.</p><p>The recommended way to do it is to use the <code>-r</code> flag from the <code>node</code> command:</p><blockquote><p>-r, &ndash;require module
Preload the specified module at startup. Follows <code>require()</code>&rsquo;s module resolution rules. module may be either a path to a file, or a Node.js module name.</p></blockquote><p>So in your <code>package.json</code> you&rsquo;ll have to add that to your <code>start</code> command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>scripts:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node -r ./tracing.js app.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>If you&rsquo;re using Typescript like me, you&rsquo;ll want to use the <code>NODE_OPTIONS</code> shell variable to specify the flag instead:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>scripts:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;NODE_OPTIONS=&#39;-r ./tracing.js&#39; ts-node app.ts&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=nodesdk-vs-nodetracerprovider-confusion><a href=#nodesdk-vs-nodetracerprovider-confusion class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>NodeSDK vs NodeTracerProvider Confusion</h3><p>One thing that made me confused is how different the code for initializing auto instrumentation compared to manual instrumentation.</p><p>This is the code provided by Honeycomb to use auto instrumentation. The key there is the <code>getNodeAutoInstrumentation()</code> function which will register all the supported auto instrumentation libraries. One more thing is that it is using the <code>NodeSDK</code> class.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// tracing.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=s2>&#34;use strict&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>NodeSDK</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/sdk-node&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>getNodeAutoInstrumentations</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/auto-instrumentations-node&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>OTLPTraceExporter</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/exporter-trace-otlp-proto&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The Trace Exporter exports the data to Honeycomb and uses
</span></span></span><span class=line><span class=cl><span class=c1>// the environment variables for endpoint, service name, and API Key.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>traceExporter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OTLPTraceExporter</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sdk</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NodeSDK</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>traceExporter</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>instrumentations</span><span class=o>:</span> <span class=p>[</span><span class=nx>getNodeAutoInstrumentations</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>sdk</span><span class=p>.</span><span class=nx>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>On the other hand, this is the code example from opentelemetry.io to start manual instrumentation. Notice that it&rsquo;s not using the <code>NodeSDK</code> class anymore and you need to create the Resource and <code>NodeTracerProvider</code> objects and configure it yourself.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>opentelemetry</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/api&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Resource</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/resources&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>SemanticResourceAttributes</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/semantic-conventions&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>NodeTracerProvider</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/sdk-trace-node&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>registerInstrumentations</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/instrumentation&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>ConsoleSpanExporter</span><span class=p>,</span> <span class=nx>BatchSpanProcessor</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>require</span><span class=p>(</span><span class=s2>&#34;@opentelemetry/sdk-trace-base&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Optionally register automatic instrumentation libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>registerInstrumentations</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>instrumentations</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>resource</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=nx>Resource</span><span class=p>.</span><span class=k>default</span><span class=p>().</span><span class=nx>merge</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>Resource</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=nx>SemanticResourceAttributes</span><span class=p>.</span><span class=nx>SERVICE_NAME</span><span class=p>]</span><span class=o>:</span> <span class=s2>&#34;service-name-here&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=nx>SemanticResourceAttributes</span><span class=p>.</span><span class=nx>SERVICE_VERSION</span><span class=p>]</span><span class=o>:</span> <span class=s2>&#34;0.1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>provider</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NodeTracerProvider</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>resource</span>: <span class=kt>resource</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>exporter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ConsoleSpanExporter</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>processor</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BatchSpanProcessor</span><span class=p>(</span><span class=nx>exporter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>provider</span><span class=p>.</span><span class=nx>addSpanProcessor</span><span class=p>(</span><span class=nx>processor</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>provider</span><span class=p>.</span><span class=nx>register</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>TBH I&rsquo;m still not clear what is the difference betwen using <code>NodeSDK</code> vs manually configuring the <code>NodeTracerProvider</code>. When using <code>NodeSDK</code> does the <code>NodeTracerProvider</code> got configured automatically?</p><h2 id=how-and-when-to-start-tracing><a href=#how-and-when-to-start-tracing class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>How and when to start tracing?</h2><p>To start manually instrumenting your application, you&rsquo;ll have to create a root span. A root span is the first span you create once the request enters your application.</p><p><img loading=lazy src=/images/request-flow.png alt="Request/Response Flow" width=1844 height=611></p><p>Now, if you have a normal HTTP request/response-based application, it is easy to figure out where to start and end your root spans. All your incoming requests will most likely be handled by a controller and each endpoint will be handled by a method. In this type of application, your root span can be started once the request hits the application in the method in your controller and ends before you send the response.</p><p>During the lifetime of that request, you can create child spans to track other works done while processing the request. There&rsquo;s only one entry point for requests and exiting the entry point means the request is finished. If your application encountered errors during the execution, it can set the span status to ERROR and add the stack trace info to the span.</p><h2 id=conclusion><a href=#conclusion class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Conclusion</h2><p>Once you managed to create spans, set attributes, and then export it to a backend. You&rsquo;re pretty much done with the basics of instrumenting your application. Go ahead and add more traces to your application!</p></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/articles/hclwrite-basics/ title="Previous post (older)"><span>Previous</span>
Generate fail HCL menggunakan library hclwrite</a></nav></div><div class=container></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/index.xml>RSS</a></nav></section><script defer src=/ts/features.10be7d4b754b9dceb71734a10c8c89ba79f6b5cda9611b507bed984bc3ac7135.js data-enable-footnotes=true></script></footer></body></html>